# Pathly データベース設計

## 概要

Pathlyでは、2つのデータベースを使用してデータを管理します：

- **Android Room（SQLite）**: ローカルデータ保存・オフライン対応
- **Supabase（PostgreSQL）**: クラウドデータ同期・複数デバイス共有

## 設計方針

### データ一貫性

- 両データベースで同一のデータ構造を維持
- UUIDを主キーとして使用し、同期時の競合を回避
- タイムスタンプによる更新管理

### 段階的実装

- 現在：Android Roomでローカル完結機能を実装
- 将来：Supabaseとの同期機能を追加

### オフライン優先設計

- Android Roomがメインデータストア
- ネットワーク接続時にSupabaseと同期
- オフライン時も全機能が利用可能

## データベース別詳細設計

### Android Room（ローカルデータベース）

詳細：[Android Room設計](./android-database-design.md)

**担当機能**：

- GPS軌跡の記録・保存
- データの一覧表示
- 地図上での軌跡表示
- オフライン動作

### Supabase（クラウドデータベース）

詳細：[Supabase設計](./supabase-database-design.md)

**担当機能**：

- 複数デバイス間でのデータ同期
- カップル間でのデータ共有
- Webアプリからのデータアクセス
- リアルタイム同期

## データ同期戦略

### 同期タイミング

- アプリ起動時
- ネットワーク接続復旧時
- 手動同期操作時

### 競合解決

- タイムスタンプベースの最終更新優先
- ユーザーによる手動選択オプション

### セキュリティ

- クラウドデータは暗号化して保存
- ローカルデータはAndroid Encrypted SharedPreferencesで保護
- 位置情報の適切なアクセス制御
